'use client'

import { useState, useEffect } from 'react'
import { Card } from 'react-bootstrap'
import { ZAPScanService } from '@/service/api'
import { Spinner } from '@/components'

interface IZapScanDataTable {
  scanUrl: string | null
  vulnId: string | null
}

export default function ZapScanDataTable({
  scanUrl,
  vulnId
}: IZapScanDataTable) {
  const [zapScans, setZapScans] = useState<any>(null)
  const [isLoading, setIsLoading] = useState<boolean>(true)

  useEffect(() => {
    if (scanUrl) {
      const fetchZapScanData = async () => {
        const fetchedData = await new ZAPScanService().getZapScanByUrl(scanUrl)
        setZapScans(fetchedData)
        setIsLoading(false)
      }
      fetchZapScanData()
    }
  }, [scanUrl])

  useEffect(() => {
    if (vulnId) {
      const fetchLatestWebScanData = async () => {
        const fetchedData = await new ZAPScanService().getZapScanById(vulnId)
        setZapScans([fetchedData])
      }
      fetchLatestWebScanData()
    }
  }, [vulnId])

  return (
    <Card>
      <Card.Body>
        <h4 className="header-title mb-3">General</h4>
        <div style={{ height: '400px', overflowY: 'scroll' }}>
          {isLoading && <Spinner />}
          {!isLoading &&
            zapScans &&
            zapScans.map((item: any, idx: number) => (
              <div key={`idx-${idx}`}>
                <Card.Title
                  style={{
                    backgroundColor: 'orange',
                    padding: '8px 5px',
                    color: 'white'
                  }}>
                  {item.title || ''}
                </Card.Title>
                <Card.Title
                  style={{
                    backgroundColor: '#eef2f7',
                    padding: '8px 0px 8px 5px'
                  }}>
                  {'Description'}
                </Card.Title>
                <Card.Text>{item.description || ''}</Card.Text>
                <Card.Title
                  style={{
                    backgroundColor: '#eef2f7',
                    padding: '8px 0px 8px 5px'
                  }}>
                  {'Solution'}
                </Card.Title>
                <Card.Text>{item.solution || ''}</Card.Text>
                <Card.Title
                  style={{
                    backgroundColor: '#eef2f7',
                    padding: '8px 0px 8px 5px'
                  }}>
                  {'Url'}
                </Card.Title>
                <Card.Text>{item.scanUrl}</Card.Text>
                <Card.Title
                  style={{
                    backgroundColor: '#eef2f7',
                    padding: '8px 0px 8px 5px'
                  }}>
                  {'Reference'}
                </Card.Title>
                <Card.Text>{item.reference || ''}</Card.Text>
                <Card.Title
                  style={{
                    backgroundColor: '#eef2f7',
                    padding: '8px 0px 8px 5px'
                  }}>
                  {'Instance'}
                </Card.Title>
                <Card.Text>{item.isntance || ''}</Card.Text>
              </div>
            ))}
        </div>
      </Card.Body>
    </Card>
  )
}
